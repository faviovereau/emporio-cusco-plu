<script>
document.addEventListener("DOMContentLoaded", () => {

  const PASSWORD = "admin2026@";
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQFNKacvGEXGdsn5IkcjYgdW8nBIM1UFZL5sjhxPa9JDJnn3DA962sjDaJ9bv1aGA/pub?gid=915072749&single=true&output=csv";

  const norm = s => s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();
  let DATA = [];

  window.auth = function(){
    if(document.getElementById('pwd').value === PASSWORD){
      document.getElementById('login').classList.add('hide');
      document.getElementById('app').classList.remove('hide');
    } else {
      alert("Contraseña incorrecta");
    }
  }

  async function loadData(){
    const res = await fetch(CSV_URL);
    const text = await res.text();
    const lines = text.trim().split("\n").map(l => l.split(","));
    const headers = lines.shift().map(h => h.trim());

    DATA = lines.map(row => {
      let obj = {};
      headers.forEach((h,i)=> obj[h] = row[i]);
      return {
        codigo: (obj.Código || obj.Codigo || "").trim(),
        nombre: (obj.Nombre || "").trim(),
        precio: (obj.Precio || "").trim(),
        categoria: (obj.Categoría || obj.Categoria || "").trim()
      };
    });
  }

  loadData();

  document.getElementById('q').addEventListener('input', ()=>{
    const k = norm(document.getElementById('q').value);
    const res = document.getElementById('res');
    res.innerHTML = "";

    DATA
      .filter(x => norm(x.nombre).includes(k) || x.codigo.includes(k))
      .forEach(x=>{
        const d = document.createElement('div');
        d.className = 'item';
        d.innerHTML = `
          <div class="code">${x.codigo}</div>
          <div class="name">${x.nombre}</div>
          <div class="price">$${x.precio}</div>
          <div class="small">Categoría ${x.categoria}</div>
        `;
        res.appendChild(d);
      });
  });

});
</script>
